<?xml version="1.0" encoding="UTF-8"?>
<PermissionTemplate xmlns="http://hrm.system/permissions">
  <Metadata>
    <Name>EmployeeSelfService</Name>
    <DisplayName>Nhân viên - Tự phục vụ</DisplayName>
    <Description>Template dành cho nhân viên thông thường, chỉ có quyền xem và cập nhật thông tin cá nhân</Description>
    <Version>1.0</Version>
    <ApplicableTo>User</ApplicableTo>
    <Category>Employee</Category>
    <IsSystem>true</IsSystem>
  </Metadata>

  <Permissions>
    <!-- Personnel Module -->
    <Module name="Personnel" displayName="Quản lý nhân sự">

      <!-- Employee Entity -->
      <Entity name="Employee" displayName="Nhân viên">

        <!-- View own profile -->
        <Action name="View" displayName="Xem thông tin">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
          <Constraints>
            <Constraint type="FieldRestriction">
              <Parameters>
                <!-- Hide sensitive salary information -->
                <Parameter name="Fields" value="Salary,Bonus,TotalCompensation" />
                <Parameter name="ApplyTo" value="View" />
              </Parameters>
            </Constraint>
          </Constraints>
        </Action>

        <!-- Update own profile (limited fields) -->
        <Action name="Update" displayName="Cập nhật thông tin">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
          <Constraints>
            <Constraint type="FieldRestriction">
              <Parameters>
                <!-- Can only update personal contact info, cannot update official records -->
                <Parameter name="Fields" value="FullName,BirthDate,EmployeeCode,Department,Position,Salary,Bonus,HireDate" />
                <Parameter name="ApplyTo" value="Update" />
              </Parameters>
            </Constraint>
          </Constraints>
        </Action>

      </Entity>

      <!-- Department Entity -->
      <Entity name="Department" displayName="Phòng ban">
        <Action name="View" displayName="Xem thông tin">
          <Scopes>
            <Scope value="Self" displayName="Phòng ban của tôi" />
          </Scopes>
        </Action>
      </Entity>

    </Module>

    <!-- Attendance Module -->
    <Module name="Attendance" displayName="Chấm công">

      <Entity name="Timesheet" displayName="Bảng chấm công">
        <!-- View own timesheet -->
        <Action name="View" displayName="Xem bảng chấm công">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
        </Action>

        <!-- Submit own timesheet -->
        <Action name="Create" displayName="Gửi bảng chấm công">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
          <Constraints>
            <Constraint type="DateRange">
              <Parameters>
                <!-- Can only submit for current month -->
                <Parameter name="MinDays" value="-30" />
                <Parameter name="MaxDays" value="0" />
              </Parameters>
            </Constraint>
          </Constraints>
        </Action>
      </Entity>

      <Entity name="LeaveRequest" displayName="Đơn xin nghỉ">
        <!-- View own leave requests -->
        <Action name="View" displayName="Xem đơn nghỉ">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
        </Action>

        <!-- Create leave request -->
        <Action name="Create" displayName="Tạo đơn nghỉ">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
          <Constraints>
            <Constraint type="DateRange">
              <Parameters>
                <!-- Can only request leave for future dates -->
                <Parameter name="MinDays" value="1" />
                <Parameter name="MaxDays" value="365" />
              </Parameters>
            </Constraint>
          </Constraints>
        </Action>

        <!-- Cancel own pending leave request -->
        <Action name="Delete" displayName="Hủy đơn nghỉ">
          <Scopes>
            <Scope value="Self" displayName="Chỉ bản thân" />
          </Scopes>
          <Constraints>
            <Constraint type="WorkflowState">
              <Parameters>
                <!-- Can only cancel pending requests -->
                <Parameter name="AllowedStates" value="Pending,Draft" />
              </Parameters>
            </Constraint>
          </Constraints>
        </Action>
      </Entity>

    </Module>

  </Permissions>
</PermissionTemplate>
